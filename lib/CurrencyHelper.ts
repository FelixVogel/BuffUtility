module CurrencyHelper {

    export interface Data {
        'date': string,
        'rates': {
            [name: string]: [number, number]
        },
        'symbols': {
            [name: string]: string
        }
    }

    const raw = `{"date":"2022-08-17","rates":{"AED":[0.5421306608084252,2],"AFN":[13.037592659010917,2],"ALL":[16.985884322390966,2],"AMD":[59.312568301724426,2],"ANG":[0.2650569576278364,2],"AOA":[63.31808139393843,2],"ARS":[19.967492628171186,2],"AUD":[0.21103992648435638,2],"AWG":[0.2656747691051263,2],"AZN":[0.25079441723875606,2],"BAM":[0.2838661430739818,2],"BBD":[0.2969415789738984,2],"BDT":[13.974798724632578,2],"BGN":[0.2834691341937952,2],"BHD":[0.05565009877284599,3],"BIF":[303.17385676913216,2],"BMD":[0.1475970939472924,2],"BND":[0.2029636357007003,2],"BOB":[1.0162456963467483,2],"BRL":[0.7594605560128977,2],"BSD":[0.14707167092510623,2],"BTC":[0.00000603965149796404,7],"BTN":[11.66956092386712,2],"BWP":[1.8452682221338044,2],"BYN":[0.3711444707034901,2],"BYR":[2892.9026309936826,2],"BZD":[0.2964335877356941,2],"CAD":[0.1897138819609653,2],"CDF":[295.3417299331477,2],"CHF":[0.14039587871952505,2],"CLF":[0.004715152302222974,4],"CLP":[130.10659870014092,2],"COP":[625.712699504952,2],"CRC":[98.09954144239586,2],"CUC":[0.1475970939472924,2],"CUP":[3.911322481176215,2],"CVE":[16.004318288686903,2],"CZK":[3.5658999151217383,2],"DJF":[26.18177849809783,2],"DKK":[1.080528305077138,2],"DOP":[7.939373272165204,2],"DZD":[21.010630628196463,2],"EGP":[2.8265575262671567,2],"ERN":[2.213956118679653,2],"ETB":[7.750548120657579,2],"EUR":[0.14526486651538784,2],"FJD":[0.32269892825034135,2],"FKP":[0.12156170771633895,2],"GBP":[0.12193736266114776,2],"GEL":[0.4135164890876306,2],"GGP":[0.12156170771633895,2],"GHS":[1.378782206855136,2],"GIP":[0.12156170771633895,2],"GMD":[8.007114637367323,2],"GNF":[1269.4782274839094,2],"GTQ":[1.1383107468255633,2],"GYD":[30.786522964850114,2],"HKD":[1.1571382356448894,2],"HNL":[3.618117405098826,2],"HRK":[1.090195681943737,2],"HTG":[18.75090823226167,2],"HUF":[58.95471004624217,2],"IDR":[2176.6509349174175,2],"ILS":[0.4812328687327107,2],"IMP":[0.12156170771633895,2],"INR":[11.72179076135786,2],"IQD":[214.65049810596406,2],"IRR":[6243.356197587528,2],"ISK":[20.34044956861419,2],"JEP":[0.12156170771633895,2],"JMD":[22.29116250678932,2],"JOD":[0.10474947839018055,2],"JPY":[19.844273448327908,2],"KES":[17.63752028805442,2],"KGS":[11.986150883421024,2],"KHR":[601.4883152572997,2],"KMF":[71.47387868960051,2],"KPW":[132.83741738242298,2],"KRW":[193.53667741771946,2],"KWD":[0.04529605488222869,3],"KYD":[0.12255851523036758,2],"KZT":[70.07054599397993,2],"LAK":[2240.1976390972836,2],"LBP":[222.40217420831007,2],"LKR":[53.71635320687446,2],"LRD":[22.663609567550854,2],"LSL":[2.4176553756643875,2],"LTL":[0.4358156629518083,2],"LVL":[0.08928007749009038,3],"LYD":[0.7151331272605936,2],"MAD":[1.5404285923674643,2],"MDL":[2.823694646277871,2],"MGA":[606.8298965844889,2],"MKD":[8.942924126562307,2],"MMK":[308.8413743973869,2],"MNT":[471.56697502039884,2],"MOP":[1.1879582107842606,2],"MRO":[52.692129709323545,2],"MUR":[6.819690710762107,2],"MVR":[2.2656333686181696,2],"MWK":[150.9507074181102,2],"MXN":[2.942627640969748,2],"MYR":[0.6592417435444656,2],"MZN":[9.421139553487759,2],"NAD":[2.4176630747023125,2],"NGN":[61.90075722216967,2],"NIO":[5.280229291875903,2],"NOK":[1.4300126220642517,2],"NPR":[18.671119761149694,2],"NZD":[0.2328823876082096,2],"OMR":[0.05675178752049869,3],"PAB":[0.1470731235737714,2],"PEN":[0.5674912917344146,2],"PGK":[0.5181801159417007,2],"PHP":[8.238647804895338,2],"PKR":[31.43564236196606,2],"PLN":[0.6802084027880977,2],"PYG":[1011.7409031145805,2],"QAR":[0.5373951714248899,2],"RON":[0.7092193945447522,2],"RSD":[17.05263091378719,2],"RUB":[8.984968136877853,2],"RWF":[153.53921548546722,2],"SAR":[0.5540204448678432,2],"SBD":[1.2173121728907577,2],"SCR":[1.9073641588285375,2],"SDG":[83.83521545757633,2],"SEK":[1.5268623064835924,2],"SGD":[0.2037060844334605,2],"SHP":[0.20330035966128304,2],"SLL":[2056.765216240554,2],"SOS":[83.53989866613442,2],"SRD":[3.5680103231024742,2],"STD":[3054.961414019832,2],"SVC":[1.2868163272480428,2],"SYP":[370.84212846730895,2],"SZL":[2.417603806636774,2],"THB":[5.232307429266542,2],"TJS":[1.502299324939639,2],"TMT":[0.518065792491753,2],"TND":[0.46359771393774263,2],"TOP":[0.3439460939512145,2],"TRY":[2.6512569696267145,2],"TTD":[0.999133349806369,2],"TWD":[4.4256246062414215,2],"TZS":[344.19641553131277,2],"UAH":[5.431506090156897,2],"UGX":[555.9310738545465,2],"USD":[0.1475970939472924,2],"UYU":[5.904057058877449,2],"UZS":[1613.3374696051426,2],"VND":[3454.214299670089,2],"VUV":[17.129537620477233,2],"WST":[0.3937093340085244,2],"XAF":[95.20644025975103,2],"XAG":[0.007322075596708123,4],"XAU":[0.00008309150364680184,6],"XCD":[0.3988884622943975,2],"XDR":[0.11138140060607407,2],"XOF":[95.20550402768633,2],"XPF":[17.35693785728802,2],"YER":[36.93615885119895,2],"ZAR":[2.4261416039013493,2],"ZMK":[1328.5510133168664,2],"ZMW":[2.369596818815635,2],"ZWL":[47.52619728392469,2]},"symbols":{"AED":"","AFN":"","ALL":"","AMD":"","ANG":"","AOA":"","ARS":"$","AUD":"A$","AWG":"","AZN":"","BAM":"","BBD":"","BDT":"","BGN":"","BHD":"","BIF":"","BMD":"","BND":"","BOB":"","BRL":"R$","BSD":"","BTC":"","BTN":"","BWP":"","BYN":"","BYR":"","BZD":"","CAD":"C$","CDF":"","CHF":"Fr","CLF":"","CLP":"","COP":"","CRC":"","CUC":"","CUP":"","CVE":"","CZK":"","DJF":"","DKK":"Kr","DOP":"","DZD":"","EGP":"","ERN":"","ETB":"","EUR":"€","FJD":"","FKP":"","GBP":"","GEL":"","GGP":"","GHS":"","GIP":"","GMD":"","GNF":"","GTQ":"","GYD":"","HKD":"","HNL":"","HRK":"","HTG":"","HUF":"","IDR":"","ILS":"","IMP":"","INR":"₹","IQD":"","IRR":"","ISK":"","JEP":"","JMD":"","JOD":"","JPY":"¥","KES":"","KGS":"","KHR":"","KMF":"","KPW":"","KRW":"₩","KWD":"","KYD":"","KZT":"","LAK":"","LBP":"","LKR":"","LRD":"","LSL":"","LTL":"","LVL":"","LYD":"","MAD":"","MDL":"","MGA":"","MKD":"","MMK":"","MNT":"","MOP":"","MRO":"","MUR":"","MVR":"","MWK":"","MXN":"M$","MYR":"","MZN":"","NAD":"","NGN":"","NIO":"","NOK":"","NPR":"","NZD":"","OMR":"","PAB":"","PEN":"","PGK":"","PHP":"","PKR":"","PLN":"","PYG":"","QAR":"","RON":"","RSD":"","RUB":"","RWF":"","SAR":"SR","SBD":"","SCR":"","SDG":"","SEK":"kr","SGD":"S$","SHP":"","SLL":"","SOS":"","SRD":"","STD":"","SVC":"","SYP":"","SZL":"","THB":"","TJS":"","TMT":"","TND":"","TOP":"","TRY":"₺","TTD":"","TWD":"","TZS":"","UAH":"","UGX":"","USD":"$","UYU":"","UZS":"","VEF":"","VND":"","VUV":"","WST":"","XAF":"","XAG":"","XAU":"","XCD":"","XDR":"","XOF":"","XPF":"","YER":"","ZAR":"","ZMK":"","ZMW":"","ZWL":""}}`;

    let data: Data;

    export function initialize(inData?: string, fetchNew: boolean = true): void {
        data = JSON.parse(inData ?? raw);
        if (fetchNew) {
            try {
                fetch('https://penguinivogel.github.io/currency-repository/rates.json')
                    .then(r => r.json().then(_pdata => {
                        data = _pdata;

                        console.debug('[CurrencyHelper] Fetched current rates.');
                    }));
            } catch (_e) {
                console.warn('[CurrencyHelper] Failed to fetch json, using fallback.', data);
            }
        } else {
            console.debug(`[CurrencyHelper] Read from ${!!inData ? 'PARAM' : 'STATIC'}`);
        }
    }

    export function getData(): Data {
        return data;
    }

}
