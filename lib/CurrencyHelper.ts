module CurrencyHelper {

    export interface Data {
        'date': string,
        'rates': {
            [name: string]: [number, number]
        },
        'symbols': {
            [name: string]: string
        }
    }

    const raw = `{"date":"2022-07-26","rates":{"AED":[0.5432754491341146,2],"AFN":[13.364319786144463,2],"ALL":[16.988967348550478,2],"AMD":[60.55850110327973,2],"ANG":[0.26650926435521766,2],"AOA":[63.73473324728038,2],"ARS":[19.31992676212233,2],"AUD":[0.2132475546166134,2],"AWG":[0.2658670034099782,2],"AZN":[0.2513208067894407,2],"BAM":[0.28494578562021067,2],"BBD":[0.29862172814142984,2],"BDT":[14.0078101148149,2],"BGN":[0.2854334254884677,2],"BHD":[0.05575315124318992,3],"BIF":[304.66648321216246,2],"BMD":[0.14790935528991522,2],"BND":[0.20534773040327367,2],"BOB":[1.0181395321020341,2],"BRL":[0.7970537099649929,2],"BSD":[0.1478903923276438,2],"BTC":[0.000007081385679083371,7],"BTN":[11.786986127426147,2],"BWP":[1.8697333472006075,2],"BYN":[0.37330268724138355,2],"BYR":[2899.0232606988666,2],"BZD":[0.2981119161942093,2],"CAD":[0.19041994063425857,2],"CDF":[296.19227626877165,2],"CHF":[0.14251366317898895,2],"CLF":[0.004950937711190875,4],"CLP":[136.6091535094098,2],"COP":[658.6181492469734,2],"CRC":[99.32885817148323,2],"CUC":[0.14790935528991522,2],"CUP":[3.9195977693138135,2],"CVE":[16.06456115548039,2],"CZK":[3.5872305745967195,2],"DJF":[26.329184334434306,2],"DKK":[1.0858838396030965,2],"DOP":[8.034317564560498,2],"DZD":[21.645649188990568,2],"EGP":[2.7985589315625234,2],"ERN":[2.218640183479788,2],"ETB":[7.780454553875161,2],"EUR":[0.14586894054950872,2],"FJD":[0.32558545593306604,2],"FKP":[0.12458957950214639,2],"GBP":[0.12318923767287113,2],"GEL":[0.43475916819111865,2],"GGP":[0.12458957950214639,2],"GHS":[1.2238437661960107,2],"GIP":[0.12458957950214639,2],"GMD":[8.000468531037043,2],"GNF":[1280.4153873352793,2],"GTQ":[1.1439762910458788,2],"GYD":[30.93808811621787,2],"HKD":[1.1609774619358646,2],"HNL":[3.638328464471212,2],"HRK":[1.0962150073175154,2],"HTG":[17.21129626579888,2],"HUF":[58.33099383864182,2],"IDR":[2218.7142051112764,2],"ILS":[0.5090219210385167,2],"IMP":[0.12458957950214639,2],"INR":[11.801908957651184,2],"IQD":[215.86006106949068,2],"IRR":[6263.960985017947,2],"ISK":[20.29172869135576,2],"JEP":[0.12458957950214639,2],"JMD":[22.607375221155547,2],"JOD":[0.10487437110429644,2],"JPY":[20.191836911522756,2],"KES":[17.54059787886139,2],"KGS":[11.974799827699606,2],"KHR":[605.7810323407488,2],"KMF":[68.72238704602121,2],"KPW":[133.11841378029715,2],"KRW":[193.74127765729816,2],"KWD":[0.04545407469569187,3],"KYD":[0.12323956245736066,2],"KZT":[70.99788665078931,2],"LAK":[2227.4109040533913,2],"LBP":[223.62302972998634,2],"LKR":[52.501620093388205,2],"LRD":[22.555025046426437,2],"LSL":[2.3428200171279308,2],"LTL":[0.4367377345007322,2],"LVL":[0.08946886055498172,3],"LYD":[0.7218381411979252,2],"MAD":[1.517191602791873,2],"MDL":[2.8543971243980537,2],"MGA":[623.0278717619466,2],"MKD":[8.976719171219358,2],"MMK":[273.8298975606191,2],"MNT":[465.12461554417354,2],"MOP":[1.19567895354789,2],"MRO":[52.80361256100786,2],"MUR":[6.611719927549814,2],"MVR":[2.2704134465490253,2],"MWK":[151.80147135082953,2],"MXN":[3.028400245118167,2],"MYR":[0.6590793423469641,2],"MZN":[9.441110447731585,2],"NAD":[2.342900974389936,2],"NGN":[61.412188575282016,2],"NIO":[5.310272426292059,2],"NOK":[1.4601752265235244,2],"NPR":[18.85905034360158,2],"NZD":[0.2372917155631511,2],"OMR":[0.05694854721099314,3],"PAB":[0.1478903923276438,2],"PEN":[0.5791824016708411,2],"PGK":[0.5212273587700564,2],"PHP":[8.194328790634163,2],"PKR":[34.4413324602591,2],"PLN":[0.6917274368828742,2],"PYG":[1020.0619711065718,2],"QAR":[0.5385401057170559,2],"RON":[0.7194606233359089,2],"RSD":[17.132301232782176,2],"RUB":[8.973734255088893,2],"RWF":[152.7952313692907,2],"SAR":[0.5558206156281941,2],"SBD":[1.2069356596900955,2],"SCR":[1.8926004916658508,2],"SDG":[67.52001781351503,2],"SEK":[1.5239469392976615,2],"SGD":[0.2054053486347907,2],"SHP":[0.2037300438525796,2],"SLL":[1947.966198373882,2],"SOS":[86.45307067977404,2],"SRD":[3.5186890933355546,2],"STD":[3061.4249178283785,2],"SVC":[1.2940229180527254,2],"SYP":[371.62659535036914,2],"SZL":[2.482624164736212,2],"THB":[5.427607797511738,2],"TJS":[1.508537490286952,2],"TMT":[0.5191618545718754,2],"TND":[0.45311969173808525,2],"TOP":[0.34637455147124135,2],"TRY":[2.6409660666542285,2],"TTD":[1.0037470813448357,2],"TWD":[4.425302484775294,2],"TZS":[344.89457424430043,2],"UAH":[5.442588537706174,2],"UGX":[568.6590969924887,2],"USD":[0.14790935528991522,2],"UYU":[6.1843306417110195,2],"UZS":[1620.968350524231,2],"VND":[3457.0852383695405,2],"VUV":[17.58583373362202,2],"WST":[0.4024569289132515,2],"XAF":[95.56763410351645,2],"XAG":[0.007937604268942066,4],"XAU":[0.00008606267492421014,6],"XCD":[0.39973238884166784,2],"XDR":[0.11205170645509446,2],"XOF":[95.5666928112431,2],"XPF":[16.73593797886038,2],"YER":[37.01428319492072,2],"ZAR":[2.4953534178332655,2],"ZMK":[1331.3623563902047,2],"ZMW":[2.4846638501319167,2],"ZWL":[47.626750409052974,2]},"symbols":{"AED":"","AFN":"","ALL":"","AMD":"","ANG":"","AOA":"","ARS":"$","AUD":"A$","AWG":"","AZN":"","BAM":"","BBD":"","BDT":"","BGN":"","BHD":"","BIF":"","BMD":"","BND":"","BOB":"","BRL":"R$","BSD":"","BTC":"","BTN":"","BWP":"","BYN":"","BYR":"","BZD":"","CAD":"C$","CDF":"","CHF":"Fr","CLF":"","CLP":"","COP":"","CRC":"","CUC":"","CUP":"","CVE":"","CZK":"","DJF":"","DKK":"Kr","DOP":"","DZD":"","EGP":"","ERN":"","ETB":"","EUR":"€","FJD":"","FKP":"","GBP":"","GEL":"","GGP":"","GHS":"","GIP":"","GMD":"","GNF":"","GTQ":"","GYD":"","HKD":"","HNL":"","HRK":"","HTG":"","HUF":"","IDR":"","ILS":"","IMP":"","INR":"₹","IQD":"","IRR":"","ISK":"","JEP":"","JMD":"","JOD":"","JPY":"¥","KES":"","KGS":"","KHR":"","KMF":"","KPW":"","KRW":"₩","KWD":"","KYD":"","KZT":"","LAK":"","LBP":"","LKR":"","LRD":"","LSL":"","LTL":"","LVL":"","LYD":"","MAD":"","MDL":"","MGA":"","MKD":"","MMK":"","MNT":"","MOP":"","MRO":"","MUR":"","MVR":"","MWK":"","MXN":"M$","MYR":"","MZN":"","NAD":"","NGN":"","NIO":"","NOK":"","NPR":"","NZD":"","OMR":"","PAB":"","PEN":"","PGK":"","PHP":"","PKR":"","PLN":"","PYG":"","QAR":"","RON":"","RSD":"","RUB":"","RWF":"","SAR":"SR","SBD":"","SCR":"","SDG":"","SEK":"kr","SGD":"S$","SHP":"","SLL":"","SOS":"","SRD":"","STD":"","SVC":"","SYP":"","SZL":"","THB":"","TJS":"","TMT":"","TND":"","TOP":"","TRY":"₺","TTD":"","TWD":"","TZS":"","UAH":"","UGX":"","USD":"$","UYU":"","UZS":"","VEF":"","VND":"","VUV":"","WST":"","XAF":"","XAG":"","XAU":"","XCD":"","XDR":"","XOF":"","XPF":"","YER":"","ZAR":"","ZMK":"","ZMW":"","ZWL":""}}`;

    let data: Data;

    export function initialize(inData?: string, fetchNew: boolean = true): void {
        data = JSON.parse(inData ?? raw);
        if (fetchNew) {
            try {
                fetch('https://penguinivogel.github.io/currency-repository/rates.json')
                    .then(r => r.json().then(_pdata => {
                        data = _pdata;

                        Cookie.write(GlobalConstants.BUFF_UTILITY_CURRENCY_CACHE, `"${JSON.stringify(_pdata).replace('"', '\"')}"`, 5);

                        console.debug('[CurrencyHelper] Fetched current rates.', _pdata);
                    }));
            } catch (_e) {
                console.debug('[CurrencyHelper] Failed to fetch json, using fallback.', data);
            }
        } else {
            console.debug(`[CurrencyHelper] Read from ${!!inData ? 'PARAM' : 'STATIC'}`, data);
        }
    }

    export function getData(): Data {
        return data;
    }

}
